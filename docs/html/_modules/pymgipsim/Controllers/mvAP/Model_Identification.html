<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../../../_static/css/theme.css?v=e21422de" />

  
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../../_static/documentation_options.js?v=5929fcd5"></script>
        <script src="../../../../_static/doctools.js?v=888ff710"></script>
        <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../../../index.html">
            <img src = "/Flag_of_Chicago,_Illinois2.svg" alt="**" style="padding: 0px 0px 0px 0px; margin: 0; max-height: 20px; width:auto; height:auto; display: inline-block; object-fit: contain; border-radius: 0;" />
            mGIPsim
            
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">ü¶Æ Guide dog</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../usage.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../userinterface.html">User interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">üê±‚Äçüíª Hacker cat</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../detailed.html">For the curious ones</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pymgipsim.html">For developers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">------------------</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../aboutus.html">üå¨Ô∏èüåÅ About us</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">mGIPsim</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../../../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pymgipsim.Controllers.mvAP.Model_Identification</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article" >
           <div itemprop="articleBody">
             
  <h1>Source code for pymgipsim.Controllers.mvAP.Model_Identification</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">pymgipsim.Controllers.mvAP.DataContainer</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pymgipsim.Controllers.mvAP</span> <span class="kn">import</span> <span class="n">Math_Tools</span>
<span class="c1"># from scipy.spatial.distance import pdist</span>


<div class="viewcode-block" id="update_ar_model">
<a class="viewcode-back" href="../../../../_autosummary/pymgipsim.Controllers.mvAP.Model_Identification.update_ar_model.html#pymgipsim.Controllers.mvAP.Model_Identification.update_ar_model">[docs]</a>
<span class="k">def</span> <span class="nf">update_ar_model</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">P</span><span class="p">):</span>
    <span class="c1"># y is a column vector</span>
    <span class="c1"># length of y is na+1, the first na is used as the regressors and the last one is used for the update</span>
    <span class="n">na</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
    <span class="n">lambda_min</span> <span class="o">=</span> <span class="mf">0.9</span>

    <span class="n">phi</span> <span class="o">=</span> <span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">na</span><span class="o">-</span><span class="mi">1</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">yh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">theta</span><span class="p">)</span>
    <span class="n">e</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">yh</span>
    <span class="n">lambda_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lambda_min</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">e</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">e</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">K</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span> <span class="o">@</span> <span class="n">phi</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">lambda_val</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">P</span> <span class="o">@</span> <span class="n">phi</span><span class="p">))</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">+</span> <span class="n">K</span> <span class="o">*</span> <span class="n">e</span>

    <span class="n">P</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">lambda_val</span> <span class="o">*</span> <span class="p">(</span><span class="n">P</span> <span class="o">-</span> <span class="n">P</span> <span class="o">@</span> <span class="p">(</span><span class="n">phi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">@</span> <span class="n">phi</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">@</span> <span class="n">P</span> <span class="o">/</span> <span class="p">(</span><span class="n">lambda_val</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">P</span> <span class="o">@</span> <span class="n">phi</span><span class="p">)))</span>

    <span class="k">return</span> <span class="n">theta</span><span class="p">,</span> <span class="n">P</span></div>



<div class="viewcode-block" id="partial_least_square_parameter_initializer">
<a class="viewcode-back" href="../../../../_autosummary/pymgipsim.Controllers.mvAP.Model_Identification.partial_least_square_parameter_initializer.html#pymgipsim.Controllers.mvAP.Model_Identification.partial_least_square_parameter_initializer">[docs]</a>
<span class="k">def</span> <span class="nf">partial_least_square_parameter_initializer</span><span class="p">(</span><span class="n">demographic_info</span><span class="p">:</span> <span class="n">Demographic_Information</span><span class="p">):</span>
    <span class="c1"># Gaussian Kernel Partial Least Square for initializing Hovorka parameters</span>
    <span class="c1"># Input = [Gender, BMI, Age, WaistSize, BodyWeight, Height, HbA1c]</span>
    <span class="c1"># Output = [TmaxI, SIT, SID, SIE, Ke, K12, TmaxG, gain, TmaxE, EGP0]</span>

    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">demographic_info</span><span class="o">.</span><span class="n">gender</span><span class="p">,</span> <span class="n">demographic_info</span><span class="o">.</span><span class="n">get_BMI</span><span class="p">(),</span> <span class="n">demographic_info</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="n">demographic_info</span><span class="o">.</span><span class="n">waist_size</span><span class="p">,</span> <span class="n">demographic_info</span><span class="o">.</span><span class="n">BW</span><span class="p">,</span> <span class="n">demographic_info</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="n">demographic_info</span><span class="o">.</span><span class="n">HbA1c</span><span class="p">])</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.500000000000000</span><span class="p">,</span> <span class="mf">26.5110103646082</span><span class="p">,</span> <span class="mf">27.6990740740741</span><span class="p">,</span> <span class="mf">92.3405555555556</span><span class="p">,</span> <span class="mf">78.5055555555556</span><span class="p">,</span> <span class="mf">172.063888888889</span><span class="p">,</span> <span class="mf">7.20833333333333</span><span class="p">])</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.507092552837110</span><span class="p">,</span> <span class="mf">4.81403955821298</span><span class="p">,</span> <span class="mf">8.35585712686107</span><span class="p">,</span> <span class="mf">13.8306413330163</span><span class="p">,</span> <span class="mf">14.8718323291179</span><span class="p">,</span> <span class="mf">7.38400405423886</span><span class="p">,</span> <span class="mf">1.02102889283311</span><span class="p">])</span>
    <span class="n">X_normalized</span> <span class="o">=</span> <span class="p">(</span><span class="n">X</span> <span class="o">-</span> <span class="n">mu</span><span class="p">)</span> <span class="o">/</span> <span class="n">std</span>

    <span class="c1"># Slope coefficients</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">85.3646096133436</span><span class="p">,</span> <span class="mf">0.00266311317921166</span><span class="p">,</span> <span class="mf">0.000753225566942580</span><span class="p">,</span> <span class="mf">0.0271108124273768</span><span class="p">,</span> <span class="mf">0.244506570993326</span><span class="p">,</span> <span class="mf">0.0776891937100525</span><span class="p">,</span> <span class="mf">49.4570510947407</span><span class="p">,</span> <span class="mf">1.00906394677902</span><span class="p">,</span> <span class="mf">4.51148271515549</span><span class="p">,</span> <span class="mf">0.0323558663012964</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">5.01920446947089</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000544935649192682</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.44275315463245e-06</span><span class="p">,</span> <span class="mf">0.000550525984782121</span><span class="p">,</span> <span class="mf">0.0154813772739024</span><span class="p">,</span> <span class="mf">0.000729467343250546</span><span class="p">,</span> <span class="mf">0.505849717087699</span><span class="p">,</span> <span class="mf">0.0154333304624955</span><span class="p">,</span> <span class="mf">0.0442250507823621</span><span class="p">,</span> <span class="mf">0.00209786396914819</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">1.53854134224320</span><span class="p">,</span> <span class="mf">0.000143659161944639</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.22968835545429e-06</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000577371506539595</span><span class="p">,</span> <span class="mf">0.000521249442374941</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.82679222214779e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.458653363835894</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0279423516774539</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.167145422721226</span><span class="p">,</span> <span class="mf">8.61116127915088e-05</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">2.38016229022136</span><span class="p">,</span> <span class="mf">0.000274278178766727</span><span class="p">,</span> <span class="mf">1.99318439348052e-05</span><span class="p">,</span> <span class="mf">0.000739850819830777</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0184525984862945</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00226432932112414</span><span class="p">,</span> <span class="mf">2.05090263393311</span><span class="p">,</span> <span class="mf">0.0565408627252661</span><span class="p">,</span> <span class="mf">0.358120298026363</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00290339471413759</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1.88810408973856</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000206478915037660</span><span class="p">,</span> <span class="mf">3.65334488600246e-06</span><span class="p">,</span> <span class="mf">0.00119652379309564</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00700673751248919</span><span class="p">,</span> <span class="mf">0.00118713345136688</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.934002484717809</span><span class="p">,</span> <span class="mf">0.0608568900289425</span><span class="p">,</span> <span class="mf">0.394285208548674</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000243416695890743</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">3.87910857277582</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000435994031234478</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.19875920675012e-05</span><span class="p">,</span> <span class="mf">0.000416784694487740</span><span class="p">,</span> <span class="mf">0.0109009145884659</span><span class="p">,</span> <span class="mf">0.00239786223136232</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.88361311220395</span><span class="p">,</span> <span class="mf">0.00605455526409981</span><span class="p">,</span> <span class="mf">0.0323242677471105</span><span class="p">,</span> <span class="mf">0.00222523795493858</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">2.53346450974719</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000286901705839819</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.47380086769483e-06</span><span class="p">,</span> <span class="mf">0.000145882065951745</span><span class="p">,</span> <span class="mf">0.00920394510470030</span><span class="p">,</span> <span class="mf">0.000910212799346275</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.457750984126490</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00113247718845633</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0268394659920222</span><span class="p">,</span> <span class="mf">0.00145617149517849</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">4.09779744403346</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000452532730020472</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.28394439462950e-06</span><span class="p">,</span> <span class="mf">0.000387679577088805</span><span class="p">,</span> <span class="mf">0.0130202467578399</span><span class="p">,</span> <span class="mf">0.00124694170983311</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.405655064011963</span><span class="p">,</span> <span class="mf">0.00720699586467728</span><span class="p">,</span> <span class="mf">0.0133059196370793</span><span class="p">,</span> <span class="mf">0.00201911272337307</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">4.73875423810878</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000523788078495877</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.04318242087221e-05</span><span class="p">,</span> <span class="mf">0.000155883789346145</span><span class="p">,</span> <span class="mf">0.0190487912692216</span><span class="p">,</span> <span class="mf">0.000937046907446384</span><span class="p">,</span> <span class="mf">0.151244436631175</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00700422446305730</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0958724286282653</span><span class="p">,</span> <span class="mf">0.00257974026895036</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">2.71689223742466</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000299451111241331</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.06905209384693e-06</span><span class="p">,</span> <span class="mf">3.66422402769617e-05</span><span class="p">,</span> <span class="mf">0.0111760697933870</span><span class="p">,</span> <span class="mf">0.000910329480737550</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.471933171912761</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00901490192861653</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0762969831836082</span><span class="p">,</span> <span class="mf">0.00167517910329316</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">3.68119965946101</span><span class="p">,</span> <span class="mf">0.000374864992354362</span><span class="p">,</span> <span class="mf">7.64408973414125e-06</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000271888853663159</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0122825485744098</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000857702820739825</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0798917123035619</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00101289544378852</span><span class="p">,</span> <span class="mf">0.0201886208882494</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00164666173716064</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1.14575169102812</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000143354516589421</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.38233416722864e-06</span><span class="p">,</span> <span class="mf">0.000226552198504614</span><span class="p">,</span> <span class="mf">0.00237932051470622</span><span class="p">,</span> <span class="mf">0.000472784130587050</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.330665521414825</span><span class="p">,</span> <span class="mf">0.00960585318110477</span><span class="p">,</span> <span class="mf">0.0508034116250701</span><span class="p">,</span> <span class="mf">0.000548183907050686</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1.75589842970697</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000218158101377731</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.94393207838721e-06</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000195864698873064</span><span class="p">,</span> <span class="mf">0.0101250658468107</span><span class="p">,</span> <span class="mf">0.000578476145363140</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.531650800326046</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0171211723661622</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.127782630554766</span><span class="p">,</span> <span class="mf">0.00156469444356097</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">9.35935374635779</span><span class="p">,</span> <span class="mf">0.000980435148082408</span><span class="p">,</span> <span class="mf">1.81997089835393e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000830930996125502</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.0289739445169756</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00235929000710135</span><span class="p">,</span>	<span class="mf">0.557318088372732</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0133351118812666</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.0199579476820188</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00437208584001287</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">4.38309869223275</span><span class="p">,</span> <span class="mf">0.000454007738991807</span><span class="p">,</span> <span class="mf">5.05976413321258e-06</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000279595510147062</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.0162196261002923</span><span class="p">,</span> <span class="mf">8.00897425343763e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.46460316934702</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00313115716073930</span><span class="p">,</span>	<span class="mf">0.0397112964700259</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00174540058956700</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">2.60661675053627</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.000383450046520399</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.07855212620862e-06</span><span class="p">,</span> <span class="mf">5.30662505587907e-05</span><span class="p">,</span>	<span class="mf">0.0115724285879320</span><span class="p">,</span>	<span class="mf">0.00101881713010471</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.416056021908190</span><span class="p">,</span> <span class="mf">0.00740874463651162</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0162769716020919</span><span class="p">,</span> <span class="mf">0.00210970311207494</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">5.12253546692536</span><span class="p">,</span> <span class="mf">0.000623693857233584</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.29038932289731e-06</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000626689794966517</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0119517229448387</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000412693221845991</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.751460322943786</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0571054859795884</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.243142415194723</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00262047750893626</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">8.31797207448485</span><span class="p">,</span> <span class="mf">0.000778803493247782</span><span class="p">,</span> <span class="mf">2.18218124853301e-05</span><span class="p">,</span> <span class="mf">0.000320985225402510</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0302229289437488</span><span class="p">,</span>	<span class="mf">7.65867684927581e-05</span><span class="p">,</span> <span class="mf">3.94274894495615</span><span class="p">,</span>	<span class="mf">0.0567518339648100</span><span class="p">,</span>	<span class="mf">0.329519382718983</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00608006258536583</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.659913573896689</span><span class="p">,</span> <span class="mf">4.48294936668759e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.16804154147722e-06</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000916412577980223</span><span class="p">,</span> <span class="mf">0.00910258259730435</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000548988661238338</span><span class="p">,</span> <span class="mf">0.365084527096328</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0483516760913177</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.324474402864938</span><span class="p">,</span> <span class="mf">0.000874890446669413</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">2.06117228969120</span><span class="p">,</span> <span class="mf">0.000324062020895845</span><span class="p">,</span> <span class="mf">8.10042178910276e-06</span><span class="p">,</span> <span class="mf">0.000292181457807190</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0101529858184776</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.00219669155893063</span><span class="p">,</span> <span class="mf">1.09100827678382</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.00984776329387057</span><span class="p">,</span> <span class="mf">0.0142253104819034</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00252410816458320</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">5.49002867503840</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.000605217176892475</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.30135032558601e-05</span><span class="p">,</span> <span class="mf">0.000233360282762826</span><span class="p">,</span>	<span class="mf">0.0211101308178268</span><span class="p">,</span>	<span class="mf">0.00144698161230136</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.260082406972022</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00638382585507709</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0912232031552514</span><span class="p">,</span>	<span class="mf">0.00300970615322388</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">2.11337485284254</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.000227097449034695</span><span class="p">,</span> <span class="mf">2.23170632988361e-06</span><span class="p">,</span> <span class="mf">0.000534344327413388</span><span class="p">,</span> <span class="mf">0.00314452365708160</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.000224794772695776</span><span class="p">,</span> <span class="mf">0.821262843112432</span><span class="p">,</span> <span class="mf">0.0257540404205159</span><span class="p">,</span> <span class="mf">0.133573176305377</span><span class="p">,</span> <span class="mf">0.000339584553908444</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.592841516144126</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.48342246179714e-05</span><span class="p">,</span> <span class="mf">4.54995124209580e-06</span><span class="p">,</span> <span class="mf">0.000555486659268531</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00408861562794384</span><span class="p">,</span> <span class="o">-</span><span class="mf">6.01586872944264e-05</span><span class="p">,</span> <span class="mf">0.197292658720259</span><span class="p">,</span>	<span class="mf">0.0309582732600067</span><span class="p">,</span>	<span class="mf">0.191969676851503</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000421415629123951</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1.61241847114240</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.000183117252323793</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.22313106141280e-06</span><span class="p">,</span> <span class="mf">0.000154869826468820</span><span class="p">,</span>	<span class="mf">0.00535299087161252</span><span class="p">,</span> <span class="mf">0.000245436864188018</span><span class="p">,</span> <span class="mf">0.0926118873674092</span><span class="p">,</span>	<span class="mf">0.00400570396068261</span><span class="p">,</span> <span class="mf">0.00647778722919792</span><span class="p">,</span> <span class="mf">0.000762322701143827</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">6.18475265503744</span><span class="p">,</span> <span class="mf">0.000680169339786079</span><span class="p">,</span> <span class="mf">2.55299230523558e-05</span><span class="p">,</span> <span class="mf">0.000550813285428934</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0332033871061178</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.00241037609545753</span><span class="p">,</span> <span class="mf">1.11543132797104</span><span class="p">,</span>	<span class="mf">0.0571367868412851</span><span class="p">,</span>	<span class="mf">0.412115022839064</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00462829423906470</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">1.34221647499469</span><span class="p">,</span> <span class="mf">0.000140712163350228</span><span class="p">,</span> <span class="mf">6.84726947272208e-06</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.07476967277104e-05</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.00501799260177724</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00116138090713706</span><span class="p">,</span> <span class="mf">0.957608341665230</span><span class="p">,</span> <span class="mf">0.00722780315234896</span><span class="p">,</span>	<span class="mf">0.0403266220869910</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000957625384108557</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">3.42302096675533</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.000369856303980041</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.27417006713399e-06</span><span class="p">,</span> <span class="mf">0.000270935263437550</span><span class="p">,</span>	<span class="mf">0.0112493281874573</span><span class="p">,</span>	<span class="mf">0.00102642952833539</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.246029193810156</span><span class="p">,</span> <span class="mf">0.00392775536946585</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00303122587338323</span><span class="p">,</span>	<span class="mf">0.00170027251590682</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">4.72771253024495</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.000519904447792043</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.09638692241729e-05</span><span class="p">,</span> <span class="mf">0.000380885538579984</span><span class="p">,</span>	<span class="mf">0.0157728033769601</span><span class="p">,</span>	<span class="mf">0.00158656438726084</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.668827462659367</span><span class="p">,</span> <span class="mf">0.00282067999270250</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0146592343116331</span><span class="p">,</span> <span class="mf">0.00244505606681875</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">1.10050097908385</span><span class="p">,</span> <span class="mf">6.63265487200289e-05</span><span class="p">,</span> <span class="mf">9.86822798401236e-07</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.60683805268836e-05</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.00368583268021920</span><span class="p">,</span> <span class="mf">0.000375872354063653</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.835254529590675</span><span class="p">,</span>	<span class="mf">0.00299170884352452</span><span class="p">,</span> <span class="mf">0.0250426308567407</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000120707074291124</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">4.99036187281830</span><span class="p">,</span> <span class="mf">0.000528053978875864</span><span class="p">,</span> <span class="mf">1.20060853160924e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000391035029221607</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.0163467398087069</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00173298203483727</span><span class="p">,</span> <span class="mf">0.587297179845986</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00222415267567055</span><span class="p">,</span>	<span class="mf">0.0165818296913400</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.00246071586129495</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">3.74867574760872</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.000277368399306121</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.96706162008782e-07</span><span class="p">,</span> <span class="mf">0.000780708700352531</span><span class="p">,</span>	<span class="mf">0.00461023428817673</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000326870612908151</span><span class="p">,</span>	<span class="mf">0.894998143190635</span><span class="p">,</span> <span class="mf">0.0231696752027439</span><span class="p">,</span> <span class="mf">0.151597631042440</span><span class="p">,</span> <span class="mf">0.000334118386848919</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">11.0943281920234</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.000673589110208685</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.32528499478470e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000164110868166595</span><span class="p">,</span> <span class="mf">0.0264942715399328</span><span class="p">,</span> <span class="mf">0.00299912725262826</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.40791889408259</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0258231732753798</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.114291966146835</span><span class="p">,</span> <span class="mf">0.00528755267653877</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">5.34553112123573</span><span class="p">,</span> <span class="mf">0.000568611148210846</span><span class="p">,</span> <span class="mf">1.05250828957008e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000243074046623700</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.0205257822065602</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000845416720754661</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.625024605636072</span><span class="p">,</span>	<span class="mf">0.00399266594294944</span><span class="p">,</span> <span class="mf">0.0835897395076819</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00259682243804208</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">9.61644467937766</span><span class="p">,</span> <span class="mf">0.00100342612325019</span><span class="p">,</span> <span class="mf">8.07446998700203e-06</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00188075990791548</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0182842558984154</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00222551411984011</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.241869364823160</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0732953387391313</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.396376988703360</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00288183717840921</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">2.35409786156329</span><span class="p">,</span> <span class="mf">0.000228221431738133</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.30934403167485e-07</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00104995946886427</span><span class="p">,</span>	<span class="mf">0.00356791215472332</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00122270744982289</span><span class="p">,</span> <span class="mf">0.689921007672290</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0491206394104460</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.319713247400069</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.01824138347105e-05</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1.24026480487265</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.000154791452912569</span><span class="p">,</span> <span class="o">-</span><span class="mf">7.39492485316537e-06</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000401642178902154</span><span class="p">,</span> <span class="mf">0.0105735779199024</span><span class="p">,</span> <span class="mf">0.000406438680131083</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.239578343268152</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0273303506905103</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.192003989449806</span><span class="p">,</span>	<span class="mf">0.00141209963109556</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">3.79078006428051</span><span class="p">,</span>	<span class="o">-</span><span class="mf">0.000505374950803857</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.03692194439428e-06</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.000130036054527433</span><span class="p">,</span> <span class="mf">0.0190483486116910</span><span class="p">,</span> <span class="mf">0.000717898677887203</span><span class="p">,</span> <span class="mf">0.0666223216360871</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00674843604800469</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.125206306082481</span><span class="p">,</span> <span class="mf">0.00291337140079723</span><span class="p">]])</span>

    <span class="c1"># Normalized training set used for calculating kernel matrix</span>
    <span class="n">X1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="mf">0.474461758851688</span><span class="p">,</span> <span class="mf">3.58641754372003</span><span class="p">,</span> <span class="mf">1.05992513951248</span><span class="p">,</span> <span class="mf">0.739279747184761</span><span class="p">,</span> <span class="mf">0.573687538630116</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.987565915530022</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.30812829845198</span><span class="p">,</span> <span class="mf">0.185609435678386</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.32608135182952</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.25778418836336</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00865233664819692</span><span class="p">,</span> <span class="mf">0.971242511967544</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.385786146442237</span><span class="p">,</span> <span class="mf">1.61175477130876</span><span class="p">,</span> <span class="mf">0.192286415388117</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0676147722286207</span><span class="p">,</span> <span class="mf">0.709115416601816</span><span class="p">,</span> <span class="mf">0.579480826468031</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.229937606155853</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.243231469441230</span><span class="p">,</span> <span class="mf">0.300741255903662</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0474424092432864</span><span class="p">,</span> <span class="mf">0.397631297266904</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.08550633690490</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.659846046380897</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.422746266933164</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.639200695231067</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.53347314916293</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.37864020115295</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.693744651405387</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="mf">0.937136632730894</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.592288020119995</span><span class="p">,</span> <span class="mf">1.49374450157466</span><span class="p">,</span> <span class="mf">1.26376118480346</span><span class="p">,</span> <span class="mf">0.682029841007474</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.595804230030509</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.394198040982844</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.02112892523961</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.494594241210339</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.827440444676222</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.09207536042180</span><span class="p">,</span> <span class="mf">2.04858714709121</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="mf">2.44480546313837</span><span class="p">,</span> <span class="mf">0.614450340798003</span><span class="p">,</span> <span class="mf">1.40408850008181</span><span class="p">,</span> <span class="mf">2.00341449426573</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.523278272940659</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.204042544530995</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.516780666848191</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.332988868187197</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.819958762756977</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.571923846861985</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.184708578011409</span><span class="p">,</span> <span class="mf">0.971242511967544</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.607418709770229</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.831641083442574</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.458442627705158</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.410544942979308</span><span class="p">,</span> <span class="mf">0.424716872861242</span><span class="p">,</span> <span class="mf">1.46094461884194</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="mf">0.254142935234747</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.183393203610586</span><span class="p">,</span> <span class="mf">0.0115283478622071</span><span class="p">,</span> <span class="mf">0.0601435266784985</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.387850394968959</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.987565915530022</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.161143659358034</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.981236748019186</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.747655535746613</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.289510765067301</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.306593668185936</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00816170178123853</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.675092755681214</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.991209792324289</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.18147489780880</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.477786152930423</span><span class="p">,</span> <span class="mf">0.424716872861242</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.06491055065368</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.915848237179571</span><span class="p">,</span> <span class="mf">0.774019049679730</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.03686844378807</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.23761182537802</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.970190270247268</span><span class="p">,</span> <span class="mf">1.16712335471730</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="mf">0.551220511696600</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.841614127747678</span><span class="p">,</span> <span class="mf">0.300741255903662</span><span class="p">,</span> <span class="mf">0.308936003497624</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.442021546157636</span><span class="p">,</span> <span class="mf">0.971242511967544</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.570222094626196</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.901452393578322</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.386139400694794</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.215545434121074</span><span class="p">,</span> <span class="mf">0.803914931182005</span><span class="p">,</span> <span class="mf">1.06918293334242</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="mf">0.00615032390010509</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.283123646661668</span><span class="p">,</span> <span class="mf">0.409196096419208</span><span class="p">,</span> <span class="mf">0.658590295243423</span><span class="p">,</span> <span class="mf">1.39979759425749</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.106102123156117</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0473961782979763</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.731910640391503</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.458442627705158</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.760199234725107</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.64732966010577</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00816170178123853</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.291424260016520</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.02112892523961</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.241532946674066</span><span class="p">,</span> <span class="mf">0.100488252649167</span><span class="p">,</span> <span class="mf">0.871628870167855</span><span class="p">,</span> <span class="mf">1.46094461884194</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.42557359054925</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.572341931509776</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.10917167079843</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.854336928656668</span><span class="p">,</span> <span class="mf">1.48105432104051</span><span class="p">,</span> <span class="mf">0.187719140968518</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.721205339089587</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.542422798594454</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.00071683028289</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.05606055851001</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.943104694652930</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.204042544530995</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="mf">3.20746251050859</span><span class="p">,</span> <span class="mf">0.873749492730801</span><span class="p">,</span> <span class="mf">2.18062515817312</span><span class="p">,</span> <span class="mf">2.54134417387465</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.753505665492548</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.497863808655630</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="mf">1.46846249672203</span><span class="p">,</span> <span class="mf">1.36242866368106</span><span class="p">,</span> <span class="mf">2.36138322569903</span><span class="p">,</span> <span class="mf">2.03703509924128</span><span class="p">,</span> <span class="mf">1.07477068712541</span><span class="p">,</span> <span class="mf">0.677421247842910</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.746821406641258</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0238244947288702</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.10917167079843</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.28468067234381</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.49835899433690</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.67314886515417</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.945178073347663</span><span class="p">,</span> <span class="mf">0.694234695238867</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.47068780585025</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.07623292149535</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.455564333954809</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.497863808655630</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="mf">0.630228864512252</span><span class="p">,</span> <span class="mf">0.0958520369324193</span><span class="p">,</span> <span class="mf">0.264589642398480</span><span class="p">,</span> <span class="mf">1.00152046599411</span><span class="p">,</span> <span class="mf">0.776829355587666</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.497863808655630</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.660711429431623</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.871533260663000</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.639200695231067</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.686233903778881</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.130537426822728</span><span class="p">,</span> <span class="mf">0.775361669217788</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.326846464983922</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.08096719107026</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.386139400694794</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.551751483876650</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.563906636332167</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.595804230030509</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.37736506184913</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0736897162544114</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.964565216777704</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.639165056813100</span><span class="p">,</span> <span class="mf">1.92796631834712</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.889625494155144</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.695101641931488</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.662099330255743</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.639200695231067</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.437441426959754</span><span class="p">,</span> <span class="mf">0.573687538630116</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.57520844377929</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.0248372111791408</span><span class="p">,</span> <span class="mf">0.205555524288605</span><span class="p">,</span> <span class="mf">0.589954163945118</span><span class="p">,</span> <span class="mf">0.631693811262978</span><span class="p">,</span> <span class="mf">1.41334038205466</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.106102123156117</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="mf">0.909494375060893</span><span class="p">,</span> <span class="mf">0.754072961069511</span><span class="p">,</span> <span class="mf">1.20453159353321</span><span class="p">,</span> <span class="mf">1.32427827375946</span><span class="p">,</span> <span class="mf">0.844543294573516</span><span class="p">,</span> <span class="mf">0.285659562343396</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="mf">0.555224754718203</span><span class="p">,</span> <span class="mf">0.594504252187796</span><span class="p">,</span> <span class="mf">0.770712231471027</span><span class="p">,</span> <span class="mf">0.799796836140766</span><span class="p">,</span> <span class="mf">0.533059175238604</span><span class="p">,</span> <span class="mf">1.16712335471730</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="mf">0.645940117438055</span><span class="p">,</span> <span class="mf">0.175636391373283</span><span class="p">,</span> <span class="mf">0.915318685491755</span><span class="p">,</span> <span class="mf">0.362728971458517</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.509735485143486</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.693744651405387</span><span class="p">],</span>
    <span class="p">[</span><span class="o">-</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="mf">0.992511647511008</span><span class="p">,</span> <span class="mf">1.94086523337730</span><span class="p">,</span> <span class="mf">0.951470298996936</span><span class="p">,</span> <span class="mf">0.0735917686687208</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.70150081129445</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.987565915530022</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.986013297183269</span><span class="p">,</span> <span class="mf">0.609620527171350</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.263177558051449</span><span class="p">,</span> <span class="mf">0.698409004460663</span><span class="p">,</span> <span class="mf">0.376177213448739</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.414935970563298</span><span class="p">,</span> <span class="mf">1.16712335471730</span><span class="p">]])</span>

    <span class="n">sigma</span> <span class="o">=</span> <span class="mf">2.0</span>  <span class="c1"># the std of gaussian kernel</span>

    <span class="n">X_kernel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span> <span class="p">(</span><span class="n">sigma</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Math_Tools</span><span class="o">.</span><span class="n">Get_euclidean_distance</span><span class="p">(</span><span class="n">X_normalized</span><span class="p">,</span> <span class="n">X1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>  <span class="c1"># convert to similarity domain</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(([</span><span class="mi">1</span><span class="p">],</span> <span class="n">X_kernel</span><span class="p">))[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span> <span class="o">@</span> <span class="n">beta</span>  <span class="c1"># add an intercept and calculate params from the slope and intercept coefficient</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">upper_scale</span> <span class="o">=</span> <span class="mf">2.0</span>
    <span class="n">lower_scale</span> <span class="o">=</span> <span class="mf">3.0</span>

    <span class="n">upper_bound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">75.0</span><span class="p">,</span> <span class="mf">29e-4</span><span class="p">,</span> <span class="mf">7e-4</span><span class="p">,</span> <span class="mf">254e-4</span><span class="p">,</span> <span class="mf">0.0995</span><span class="p">,</span> <span class="mf">0.08</span><span class="p">,</span> <span class="mf">43.4</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">15.0</span><span class="p">,</span> <span class="mf">0.0318</span><span class="p">])</span> <span class="o">*</span> <span class="n">upper_scale</span>
    <span class="n">lower_bound</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">62.8</span><span class="p">,</span> <span class="mf">21e-4</span><span class="p">,</span> <span class="mf">4e-4</span><span class="p">,</span> <span class="mf">178e-4</span><span class="p">,</span> <span class="mf">0.175</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">37.8</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="mf">15.3</span><span class="p">,</span> <span class="mf">0.0235</span><span class="p">])</span> <span class="o">/</span> <span class="n">lower_scale</span>

    <span class="n">low_limit_breach</span> <span class="o">=</span> <span class="n">params</span> <span class="o">&lt;</span> <span class="n">lower_bound</span>
    <span class="n">up_limit_breach</span> <span class="o">=</span> <span class="n">params</span> <span class="o">&gt;</span> <span class="n">upper_bound</span>

    <span class="n">params</span><span class="p">[</span><span class="n">low_limit_breach</span><span class="p">]</span> <span class="o">=</span> <span class="n">lower_bound</span><span class="p">[</span><span class="n">low_limit_breach</span><span class="p">]</span>
    <span class="n">params</span><span class="p">[</span><span class="n">up_limit_breach</span><span class="p">]</span> <span class="o">=</span> <span class="n">upper_bound</span><span class="p">[</span><span class="n">up_limit_breach</span><span class="p">]</span>

    <span class="n">hovorka_params</span> <span class="o">=</span> <span class="n">Hovorka_Parameters</span><span class="p">(</span><span class="n">BW</span><span class="o">=</span><span class="n">demographic_info</span><span class="o">.</span><span class="n">BW</span><span class="p">)</span>
    <span class="n">hovorka_params</span><span class="o">.</span><span class="n">TmaxI</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">hovorka_params</span><span class="o">.</span><span class="n">SIT</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">hovorka_params</span><span class="o">.</span><span class="n">SID</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">hovorka_params</span><span class="o">.</span><span class="n">SIE</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">hovorka_params</span><span class="o">.</span><span class="n">Ke</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
    <span class="n">hovorka_params</span><span class="o">.</span><span class="n">K12</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
    <span class="n">hovorka_params</span><span class="o">.</span><span class="n">TmaxG</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
    <span class="n">hovorka_params</span><span class="o">.</span><span class="n">gain</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
    <span class="n">hovorka_params</span><span class="o">.</span><span class="n">TmaxE</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
    <span class="n">hovorka_params</span><span class="o">.</span><span class="n">EGP0</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">hovorka_params</span></div>



<div class="viewcode-block" id="nonlinear_recursive_least_square">
<a class="viewcode-back" href="../../../../_autosummary/pymgipsim.Controllers.mvAP.Model_Identification.nonlinear_recursive_least_square.html#pymgipsim.Controllers.mvAP.Model_Identification.nonlinear_recursive_least_square">[docs]</a>
<span class="k">def</span> <span class="nf">nonlinear_recursive_least_square</span><span class="p">(</span><span class="n">pw_data_object</span><span class="p">:</span> <span class="n">Data_PW</span><span class="p">,</span> <span class="n">model_states</span><span class="p">:</span> <span class="n">Hovorka_Model_Extended_States_Matrix</span><span class="p">,</span> <span class="n">hovorka_params</span><span class="p">:</span> <span class="n">Hovorka_Parameters</span><span class="p">,</span> <span class="n">noise_error_cov_mat</span><span class="p">:</span> <span class="n">Noise_Error_Covariance_Matrix</span><span class="p">,</span> <span class="n">nrls_model</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">5.0</span><span class="p">):</span>
    <span class="n">current_state_object</span> <span class="o">=</span> <span class="n">model_states</span><span class="o">.</span><span class="n">get_current_state_object</span><span class="p">()</span>
    <span class="n">previous_state_object</span> <span class="o">=</span> <span class="n">model_states</span><span class="o">.</span><span class="n">get_previous_state_object</span><span class="p">()</span>

    <span class="n">G</span> <span class="o">=</span> <span class="n">pw_data_object</span><span class="o">.</span><span class="n">cgm_pw</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mi">18</span>
    <span class="n">pG</span> <span class="o">=</span> <span class="n">pw_data_object</span><span class="o">.</span><span class="n">cgm_pw</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">18</span>  <span class="c1"># previous G</span>
    <span class="n">Q2</span> <span class="o">=</span> <span class="n">current_state_object</span><span class="o">.</span><span class="n">Q2</span>
    <span class="n">BW</span> <span class="o">=</span> <span class="n">hovorka_params</span><span class="o">.</span><span class="n">BW</span>

    <span class="c1"># p = [0.0053, 0.0257]</span>
    <span class="n">p</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.1253</span><span class="p">]</span>  <span class="c1"># exercise compartment parameters</span>
    <span class="n">alpha</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">hovorka_params</span><span class="o">.</span><span class="n">K12</span><span class="p">,</span> <span class="n">hovorka_params</span><span class="o">.</span><span class="n">EGP0</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">VG</span> <span class="o">=</span> <span class="n">hovorka_params</span><span class="o">.</span><span class="n">get_VG</span><span class="p">()</span>
    <span class="n">f01</span> <span class="o">=</span> <span class="n">hovorka_params</span><span class="o">.</span><span class="n">F01</span>

    <span class="n">sw1</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">pG</span> <span class="o">&gt;=</span> <span class="mf">4.5</span> <span class="k">else</span> <span class="mf">0.0</span>
    <span class="n">sw2</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="k">if</span> <span class="n">pG</span> <span class="o">&gt;=</span> <span class="mf">9.0</span> <span class="k">else</span> <span class="mf">0.0</span>
    <span class="n">f01c</span> <span class="o">=</span> <span class="n">sw1</span> <span class="o">*</span> <span class="n">f01</span> <span class="o">*</span> <span class="n">BW</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">sw1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">f01</span> <span class="o">*</span> <span class="n">BW</span> <span class="o">*</span> <span class="n">pG</span> <span class="o">/</span> <span class="mf">4.5</span><span class="p">)</span>
    <span class="n">fr</span> <span class="o">=</span> <span class="n">sw2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.003</span> <span class="o">*</span> <span class="p">(</span><span class="n">pG</span> <span class="o">-</span> <span class="mi">9</span><span class="p">)</span> <span class="o">*</span> <span class="n">VG</span><span class="p">)</span>

    <span class="n">P</span> <span class="o">=</span> <span class="n">noise_error_cov_mat</span><span class="o">.</span><span class="n">P_NRLS</span>

    <span class="k">if</span> <span class="n">nrls_model</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">lambda_min</span> <span class="o">=</span> <span class="mf">0.9</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([(</span><span class="n">delta</span> <span class="o">/</span> <span class="n">VG</span><span class="p">)</span> <span class="o">*</span> <span class="n">previous_state_object</span><span class="o">.</span><span class="n">Q2</span><span class="p">,</span> <span class="p">(</span><span class="n">delta</span> <span class="o">/</span> <span class="n">VG</span><span class="p">)</span> <span class="o">*</span> <span class="n">BW</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">previous_state_object</span><span class="o">.</span><span class="n">x3</span><span class="p">)])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">Gh</span> <span class="o">=</span> <span class="n">pG</span> <span class="o">+</span> <span class="p">(</span><span class="n">delta</span> <span class="o">/</span> <span class="n">VG</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">previous_state_object</span><span class="o">.</span><span class="n">Ug</span> <span class="o">-</span> <span class="n">f01c</span> <span class="o">-</span> <span class="n">fr</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">previous_state_object</span><span class="o">.</span><span class="n">R2</span><span class="p">)</span> <span class="o">*</span> <span class="n">previous_state_object</span><span class="o">.</span><span class="n">x1</span> <span class="o">*</span> <span class="n">pG</span> <span class="o">*</span> <span class="n">VG</span> <span class="o">+</span> <span class="n">hovorka_params</span><span class="o">.</span><span class="n">K12</span> <span class="o">*</span> <span class="n">previous_state_object</span><span class="o">.</span><span class="n">Q2</span> <span class="o">+</span> <span class="n">hovorka_params</span><span class="o">.</span><span class="n">EGP0</span> <span class="o">*</span> <span class="n">BW</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">previous_state_object</span><span class="o">.</span><span class="n">x3</span><span class="p">))</span>
        <span class="n">e</span> <span class="o">=</span> <span class="n">G</span> <span class="o">-</span> <span class="n">Gh</span>
        <span class="n">lambda_val</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">lambda_min</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">e</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">e</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">K</span> <span class="o">=</span> <span class="n">P</span> <span class="o">@</span> <span class="n">phi</span> <span class="o">/</span> <span class="p">(</span><span class="n">lambda_val</span> <span class="o">+</span> <span class="n">phi</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P</span> <span class="o">@</span> <span class="n">phi</span><span class="p">)</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">+</span> <span class="n">K</span> <span class="o">*</span> <span class="n">e</span>
        <span class="n">P</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">lambda_val</span> <span class="o">*</span> <span class="p">(</span><span class="n">P</span> <span class="o">-</span> <span class="n">P</span> <span class="o">@</span> <span class="p">(</span><span class="n">phi</span> <span class="o">@</span> <span class="n">phi</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">@</span> <span class="n">P</span> <span class="o">/</span> <span class="p">(</span><span class="n">lambda_val</span> <span class="o">+</span> <span class="n">phi</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P</span> <span class="o">@</span> <span class="n">phi</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">nrls_l</span> <span class="o">=</span> <span class="mf">0.999</span>
        <span class="n">nrls_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.0001</span><span class="p">]))</span>
        <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="n">pG</span> <span class="o">+</span> <span class="p">(</span><span class="n">delta</span> <span class="o">/</span> <span class="n">VG</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">previous_state_object</span><span class="o">.</span><span class="n">Ug</span> <span class="o">-</span> <span class="n">f01c</span> <span class="o">-</span> <span class="n">fr</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">previous_state_object</span><span class="o">.</span><span class="n">R2</span><span class="p">)</span> <span class="o">*</span> <span class="n">previous_state_object</span><span class="o">.</span><span class="n">x1</span> <span class="o">*</span> <span class="n">pG</span> <span class="o">*</span> <span class="n">VG</span><span class="p">)],</span>
            <span class="p">[</span><span class="n">previous_state_object</span><span class="o">.</span><span class="n">Q2</span> <span class="o">+</span> <span class="n">delta</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">previous_state_object</span><span class="o">.</span><span class="n">R2</span><span class="p">)</span> <span class="o">*</span> <span class="n">previous_state_object</span><span class="o">.</span><span class="n">x1</span> <span class="o">*</span> <span class="n">pG</span> <span class="o">*</span> <span class="n">VG</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">previous_state_object</span><span class="o">.</span><span class="n">R2</span><span class="p">)</span> <span class="o">*</span> <span class="n">previous_state_object</span><span class="o">.</span><span class="n">x2</span> <span class="o">*</span> <span class="n">previous_state_object</span><span class="o">.</span><span class="n">Q2</span><span class="p">)]</span>
        <span class="p">])</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[(</span><span class="n">delta</span> <span class="o">/</span> <span class="n">VG</span><span class="p">)</span> <span class="o">*</span> <span class="n">previous_state_object</span><span class="o">.</span><span class="n">Q2</span><span class="p">,</span> <span class="p">(</span><span class="n">delta</span> <span class="o">/</span> <span class="n">VG</span><span class="p">)</span> <span class="o">*</span> <span class="n">BW</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">previous_state_object</span><span class="o">.</span><span class="n">x3</span><span class="p">)],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">delta</span> <span class="o">*</span> <span class="n">previous_state_object</span><span class="o">.</span><span class="n">Q2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="p">])</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="n">G</span><span class="p">],</span>
            <span class="p">[</span><span class="n">Q2</span><span class="p">]</span>
        <span class="p">])</span>

        <span class="n">g_k</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span> <span class="o">@</span> <span class="n">F</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">nrls_l</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">nrls_w</span><span class="p">)</span> <span class="o">+</span> <span class="n">F</span> <span class="o">@</span> <span class="n">P</span> <span class="o">@</span> <span class="n">F</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">S_k</span> <span class="o">=</span> <span class="n">Y</span> <span class="o">-</span> <span class="n">M</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">theta</span> <span class="o">+</span> <span class="n">g_k</span> <span class="o">@</span> <span class="p">(</span><span class="n">S_k</span> <span class="o">-</span> <span class="n">F</span> <span class="o">@</span> <span class="n">theta</span><span class="p">)</span>
        <span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span> <span class="o">-</span> <span class="n">g_k</span> <span class="o">@</span> <span class="n">F</span> <span class="o">@</span> <span class="n">P</span><span class="p">)</span> <span class="o">/</span> <span class="n">nrls_l</span>

    <span class="n">hovorka_params</span><span class="o">.</span><span class="n">K12</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">hovorka_params</span><span class="o">.</span><span class="n">EGP0</span> <span class="o">=</span> <span class="n">theta</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">noise_error_cov_mat</span><span class="o">.</span><span class="n">P_NRLS</span> <span class="o">=</span> <span class="n">P</span></div>




</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Andy, Mate.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a customized 
    theme
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>