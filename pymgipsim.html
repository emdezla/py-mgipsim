<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e21422de" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/documentation_options.js?v=5929fcd5"></script>
        <script src="_static/doctools.js?v=888ff710"></script>
        <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="üå¨Ô∏èüåÅ About us" href="aboutus.html" />
    <link rel="prev" title="Models" href="models.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html">
            <img src = "Flag_of_Chicago,_Illinois2.svg" alt="**" style="padding: 0px 0px 0px 0px; margin: 0; max-height: 20px; width:auto; height:auto; display: inline-block; object-fit: contain; border-radius: 0;" />
            mGIPsim
            
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">ü¶Æ Guide dog</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="usage.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="userinterface.html">User interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">üê±‚Äçüíª Hacker cat</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="detailed.html">For the curious ones</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">For developers</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#programatically-run-simulations">Programatically run simulations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-add-a-model">How to add a model?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-add-a-controller">How to add a controller?</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pymgipsim-package">PYmGIPsim package</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">------------------</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="aboutus.html">üå¨Ô∏èüåÅ About us</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">mGIPsim</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">For developers</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/pymgipsim.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article" >
           <div itemprop="articleBody">
             
  <section id="for-developers">
<h1>For developers<a class="headerlink" href="#for-developers" title="Link to this heading">¬∂</a></h1>
<section id="programatically-run-simulations">
<h2>Programatically run simulations<a class="headerlink" href="#programatically-run-simulations" title="Link to this heading">¬∂</a></h2>
<p>An example is provided in <code class="code docutils literal notranslate"><span class="pre">manual_script.py</span></code> on how programatically defined scenarios can be simulated.</p>
</section>
<section id="how-to-add-a-model">
<h2>How to add a model?<a class="headerlink" href="#how-to-add-a-model" title="Link to this heading">¬∂</a></h2>
<p><strong>Defining the model</strong></p>
<ul class="simple">
<li><p>Define the state variables, inputs, constants, parameters, and model equations in the VirtualPatient/Models folder</p></li>
<li><dl class="simple">
<dt>In the Parameters file:</dt><dd><ul>
<li><p>Define all model parameters and their vectorization function (<code class="code docutils literal notranslate"><span class="pre">as_array</span></code>).</p></li>
<li><p>Define <code class="code docutils literal notranslate"><span class="pre">generate</span></code> function that either loads patient files or draws random samples from distributions.</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>In the Inputs file:</dt><dd><ul>
<li><p>Define all model inputs and their vectorization function (<code class="code docutils literal notranslate"><span class="pre">as_array</span></code>).</p></li>
</ul>
</dd>
</dl>
</li>
<li><dl class="simple">
<dt>In the Model file:</dt><dd><ul>
<li><p>Define a unique name in the Model class, same name should be given to the folder.</p></li>
<li><p>Diff. equations should be defined in the <code class="code docutils literal notranslate"><span class="pre">model</span></code> function.</p></li>
<li><p>Initial conditions should be defined in the <code class="code docutils literal notranslate"><span class="pre">preprocessing</span></code> function.</p></li>
<li><p>A <code class="code docutils literal notranslate"><span class="pre">from_scenario</span></code> function has to be defined which passes the inputs, parameters, etc. from the scenario to the model. Unit conversions from the default units to the model specific ones is convenient to do in this function.</p></li>
</ul>
</dd>
</dl>
</li>
<li><p>Define virtual patient parameters in <code class="code docutils literal notranslate"><span class="pre">JSON</span></code> files in the Patients folder.</p></li>
</ul>
<p><strong>Add model to the generate functions</strong></p>
<ul class="simple">
<li><p>Add functions that generate the necessary inputs of the model in <code class="code docutils literal notranslate"><span class="pre">generate_inputs_main</span></code> function in the generate_inputs file.</p></li>
<li><p>Add model parameter generation in <code class="code docutils literal notranslate"><span class="pre">generate_virtual_subjects_main</span></code> function in the generate_subjects file.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If the added model is just an auixiliary model, it can be readily used for simulation. An example is the physical activity -&gt; heart rate model, and the implementation can be found in <code class="code docutils literal notranslate"><span class="pre">pymgipsim/InputGeneration/heart_rate_settings.py</span></code>. If the added model represents the patient, the following steps are needed.</p>
</div>
<p><strong>Update VirtualCohort</strong></p>
<ul class="simple">
<li><p>Add the defined model to the virtual patient class in VirtualPatient/VirtualPatient.</p></li>
</ul>
<p><strong>Update plots</strong></p>
<ul class="simple">
<li><p>Update plotting function with specifics of the defined model.</p></li>
</ul>
<p><strong>Optional: Controller compatibility</strong>
*</p>
</section>
<section id="how-to-add-a-controller">
<h2>How to add a controller?<a class="headerlink" href="#how-to-add-a-controller" title="Link to this heading">¬∂</a></h2>
<p><strong>Define controller class</strong></p>
<ul class="simple">
<li><p>Define the class similarly to already existing ones in the <code class="code docutils literal notranslate"><span class="pre">pymgipsim/Controllers</span></code> folder.</p></li>
<li><p>The controller has to have a unique name, same as the folder name.</p></li>
<li><p><code class="code docutils literal notranslate"><span class="pre">run</span></code> function of the controller will be called in every sampling time of the simulation with the available data up to that point. The function has to modify inplace the current sample of the input array.</p></li>
</ul>
<p><strong>Adding it to the solver</strong></p>
<ul class="simple">
<li><p>Add the controller to the <code class="code docutils literal notranslate"><span class="pre">set_controller</span></code> function in <code class="code docutils literal notranslate"><span class="pre">pymgipsim/ModelSolver/singlescale.py</span></code>.</p></li>
</ul>
<p><strong>Update plots</strong></p>
<ul class="simple">
<li><p>Update plotting function with specifics of the defined controller.</p></li>
</ul>
</section>
<section id="pymgipsim-package">
<h2>PYmGIPsim package<a class="headerlink" href="#pymgipsim-package" title="Link to this heading">¬∂</a></h2>
<table class="autosummary longtable docutils align-default">
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="_autosummary/pymgipsim.html#module-pymgipsim" title="pymgipsim"><code class="xref py py-obj docutils literal notranslate"><span class="pre">pymgipsim</span></code></a></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="models.html" class="btn btn-neutral float-left" title="Models" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="aboutus.html" class="btn btn-neutral float-right" title="üå¨Ô∏èüåÅ About us" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Illinois Tech.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a customized 
    theme
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>